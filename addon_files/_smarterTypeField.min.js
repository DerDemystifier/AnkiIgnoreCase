(()=>{"use strict";function e(){}function n(e,n,t,o,r){for(var i=0,s=n.length,u=0,a=0;i<s;i++){var c=n[i];if(c.removed){if(c.value=e.join(o.slice(a,a+c.count)),a+=c.count,i&&n[i-1].added){var p=n[i-1];n[i-1]=n[i],n[i]=p}}else{if(!c.added&&r){var l=t.slice(u,u+c.count);l=l.map((function(e,n){var t=o[a+n];return t.length>e.length?t:e})),c.value=e.join(l)}else c.value=e.join(t.slice(u,u+c.count));u+=c.count,c.added||(a+=c.count)}}var f=n[s-1];return s>1&&"string"==typeof f.value&&(f.added||f.removed)&&e.equals("",f.value)&&(n[s-2].value+=f.value,n.pop()),n}e.prototype={diff:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=o.callback;"function"==typeof o&&(r=o,o={}),this.options=o;var i=this;function s(e){return r?(setTimeout((function(){r(void 0,e)}),0),!0):e}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e));var u=(t=this.removeEmpty(this.tokenize(t))).length,a=e.length,c=1,p=u+a;o.maxEditLength&&(p=Math.min(p,o.maxEditLength));var l=[{newPos:-1,components:[]}],f=this.extractCommon(l[0],t,e,0);if(l[0].newPos+1>=u&&f+1>=a)return s([{value:this.join(t),count:t.length}]);function d(){for(var o=-1*c;o<=c;o+=2){var r=void 0,p=l[o-1],f=l[o+1],d=(f?f.newPos:0)-o;p&&(l[o-1]=void 0);var h=p&&p.newPos+1<u,v=f&&0<=d&&d<a;if(h||v){if(!h||v&&p.newPos<f.newPos?(r={newPos:(g=f).newPos,components:g.components.slice(0)},i.pushComponent(r.components,void 0,!0)):((r=p).newPos++,i.pushComponent(r.components,!0,void 0)),d=i.extractCommon(r,t,e,o),r.newPos+1>=u&&d+1>=a)return s(n(i,r.components,t,e,i.useLongestToken));l[o]=r}else l[o]=void 0}var g;c++}if(r)!function e(){setTimeout((function(){if(c>p)return r();d()||e()}),0)}();else for(;c<=p;){var h=d();if(h)return h}},pushComponent:function(e,n,t){var o=e[e.length-1];o&&o.added===n&&o.removed===t?e[e.length-1]={count:o.count+1,added:n,removed:t}:e.push({count:1,added:n,removed:t})},extractCommon:function(e,n,t,o){for(var r=n.length,i=t.length,s=e.newPos,u=s-o,a=0;s+1<r&&u+1<i&&this.equals(n[s+1],t[u+1]);)s++,u++,a++;return a&&e.components.push({count:a}),e.newPos=s,u},equals:function(e,n){return this.options.comparator?this.options.comparator(e,n):e===n||this.options.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],t=0;t<e.length;t++)e[t]&&n.push(e[t]);return n},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};var t=new e;function o(e,n,o){return t.diff(e,n,o)}var r=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,i=/\S/,s=new e;s.equals=function(e,n){return this.options.ignoreCase&&(e=e.toLowerCase(),n=n.toLowerCase()),e===n||this.options.ignoreWhitespace&&!i.test(e)&&!i.test(n)},s.tokenize=function(e){for(var n=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<n.length-1;t++)!n[t+1]&&n[t+2]&&r.test(n[t])&&r.test(n[t+2])&&(n[t]+=n[t+2],n.splice(t+1,2),t--);return n};var u=new e;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}u.tokenize=function(e){var n=[],t=e.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var o=0;o<t.length;o++){var r=t[o];o%2&&!this.options.newlineIsToken?n[n.length-1]+=r:(this.options.ignoreWhitespace&&(r=r.trim()),n.push(r))}return n},(new e).tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)},(new e).tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};var c=Object.prototype.toString,p=new e;function l(e,n,t,o,r){var i,s;for(n=n||[],t=t||[],o&&(e=o(r,e)),i=0;i<n.length;i+=1)if(n[i]===e)return t[i];if("[object Array]"===c.call(e)){for(n.push(e),s=new Array(e.length),t.push(s),i=0;i<e.length;i+=1)s[i]=l(e[i],n,t,o,r);return n.pop(),t.pop(),s}if(e&&e.toJSON&&(e=e.toJSON()),"object"===a(e)&&null!==e){n.push(e),s={},t.push(s);var u,p=[];for(u in e)e.hasOwnProperty(u)&&p.push(u);for(p.sort(),i=0;i<p.length;i+=1)s[u=p[i]]=l(e[u],n,t,o,u);n.pop(),t.pop()}else s=e;return s}p.useLongestToken=!0,p.tokenize=u.tokenize,p.castInput=function(e){var n=this.options,t=n.undefinedReplacement,o=n.stringifyReplacer,r=void 0===o?function(e,n){return void 0===n?t:n}:o;return"string"==typeof e?e:JSON.stringify(l(e,null,null,r),r,"  ")},p.equals=function(n,t){return e.prototype.equals.call(p,n.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))};var f=new e;function d(e){return[...e].map((e=>e.innerHTML)).join("").trim()}function h(e){return/[!"#$%&'()*+,-./:;<=>¿?@[\]^_`{|}~]/.test(e)}function v(e){let n=[],t="";for(let o=0;o<e.length;o++)h(e[o])?(t&&n.push(t),n.push(e[o]),t=""):t+=e[o];return t&&n.push(t),n}function g(e){if(!document.querySelector("span#typearrow"))return;const n="code#typeans",t=`${n} > span[class^="type"]`,r=`${n} br ~ span[class^="type"]`,i=[...document.querySelectorAll(t)],s=[...document.querySelectorAll(r)],u=i.filter((e=>!s.includes(e)&&!e.classList.contains("typeMissed"))),a=document.querySelector(n),c=d(u),p=d(s),l=e.ignore_case?{ignoreCase:!0}:{};let f=()=>o(c,p,l);if(e.ignore_accents){var g=c.normalize("NFD").replace(/[\u0300-\u036f]/g,""),m=p.normalize("NFD").replace(/[\u0300-\u036f]/g,"");f=()=>o(g,m,l)}if(f=f(),e.ignore_punctuations){const e=[];for(const n of f){if(!n.value)continue;if(!n.value.split("").some(h)){e.push(n);continue}if(n.value.split("").every((e=>h(e)))){e.push(n);continue}const t=v(n.value);t.length>1?t.forEach((t=>{let o={...n};o.value=t,e.push(o)})):e.push(n)}f=e}if(1===f.length)s.forEach((e=>e.setAttribute("class","typeGood"))),a.innerHTML=s.map((e=>e.outerHTML)).join("");else{const n=[],t=[],o=c.split("");let r=0;f.forEach(((i,s)=>{let u=i.added?"typeMissed":i.removed?"typeBad":"typeGood",a=i.added?"typeBad":i.removed?"typeMissed":"typeGood",c="",l="";var f;"typeMissed"===u?e.ignore_punctuations&&h(i.value)||("typeBad",(f=n).length>0&&f.at(-1).includes("typeBad")||(c='<span class="typeMissed">-</span>'.repeat(i.value.length))):c=e.ignore_punctuations&&h(i.value)?`<span class="typeGood">${o.splice(0,i.value.length).join("")}</span>`:`<span class="${u}">${o.splice(0,i.value.length).join("")}</span>`,"typeMissed"!==a&&(l=e.ignore_punctuations&&h(i.value)?`<span class="typeGood">${i.value}</span>`:e.ignore_accents?`<span class="${a}">${p.slice(r,r+i.value.length)}</span>`:`<span class="${a}">${i.value}</span>`,r+=i.value.length),n.push(c),t.push(l)})),t.every((e=>e.includes("typeGood")))?a.innerHTML=t.join(""):a.innerHTML=`${n.join("")}<br><span id="typearrow">⇩</span><br>${t.join("")}`}}if(f.tokenize=function(e){return e.slice()},f.join=f.removeEmpty=function(e){return e},window.addon_config)window.addon_config.enabled&&g(addon_config);else{var m=document.currentScript.getAttribute("data-config");fetch("_smarterTypeField.config".concat(m,".json")).then((function(e){if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((function(e){e.enabled&&g(e)})).catch((function(e){addon_config={ignore_case:!0,ignore_accents:!1,ignore_punctuations:!1},g(addon_config),console.error("There has been a problem with your fetch operation:",e)}))}})();