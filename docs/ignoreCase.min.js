(()=>{"use strict";function n(){}function t(n,t,e,o,r){for(var i=0,u=t.length,s=0,a=0;i<u;i++){var p=t[i];if(p.removed){if(p.value=n.join(o.slice(a,a+p.count)),a+=p.count,i&&t[i-1].added){var c=t[i-1];t[i-1]=t[i],t[i]=c}}else{if(!p.added&&r){var l=e.slice(s,s+p.count);l=l.map((function(n,t){var e=o[a+t];return e.length>n.length?e:n})),p.value=n.join(l)}else p.value=n.join(e.slice(s,s+p.count));s+=p.count,p.added||(a+=p.count)}}var f=t[u-1];return u>1&&"string"==typeof f.value&&(f.added||f.removed)&&n.equals("",f.value)&&(t[u-2].value+=f.value,t.pop()),t}n.prototype={diff:function(n,e){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=o.callback;"function"==typeof o&&(r=o,o={}),this.options=o;var i=this;function u(n){return r?(setTimeout((function(){r(void 0,n)}),0),!0):n}n=this.castInput(n),e=this.castInput(e),n=this.removeEmpty(this.tokenize(n));var s=(e=this.removeEmpty(this.tokenize(e))).length,a=n.length,p=1,c=s+a;o.maxEditLength&&(c=Math.min(c,o.maxEditLength));var l=[{newPos:-1,components:[]}],f=this.extractCommon(l[0],e,n,0);if(l[0].newPos+1>=s&&f+1>=a)return u([{value:this.join(e),count:e.length}]);function h(){for(var o=-1*p;o<=p;o+=2){var r=void 0,c=l[o-1],f=l[o+1],h=(f?f.newPos:0)-o;c&&(l[o-1]=void 0);var v=c&&c.newPos+1<s,m=f&&0<=h&&h<a;if(v||m){if(!v||m&&c.newPos<f.newPos?(r={newPos:(d=f).newPos,components:d.components.slice(0)},i.pushComponent(r.components,void 0,!0)):((r=c).newPos++,i.pushComponent(r.components,!0,void 0)),h=i.extractCommon(r,e,n,o),r.newPos+1>=s&&h+1>=a)return u(t(i,r.components,e,n,i.useLongestToken));l[o]=r}else l[o]=void 0}var d;p++}if(r)!function n(){setTimeout((function(){if(p>c)return r();h()||n()}),0)}();else for(;p<=c;){var v=h();if(v)return v}},pushComponent:function(n,t,e){var o=n[n.length-1];o&&o.added===t&&o.removed===e?n[n.length-1]={count:o.count+1,added:t,removed:e}:n.push({count:1,added:t,removed:e})},extractCommon:function(n,t,e,o){for(var r=t.length,i=e.length,u=n.newPos,s=u-o,a=0;u+1<r&&s+1<i&&this.equals(t[u+1],e[s+1]);)u++,s++,a++;return a&&n.components.push({count:a}),n.newPos=u,s},equals:function(n,t){return this.options.comparator?this.options.comparator(n,t):n===t||this.options.ignoreCase&&n.toLowerCase()===t.toLowerCase()},removeEmpty:function(n){for(var t=[],e=0;e<n.length;e++)n[e]&&t.push(n[e]);return t},castInput:function(n){return n},tokenize:function(n){return n.split("")},join:function(n){return n.join("")}},new n;var e=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,o=/\S/,r=new n;r.equals=function(n,t){return this.options.ignoreCase&&(n=n.toLowerCase(),t=t.toLowerCase()),n===t||this.options.ignoreWhitespace&&!o.test(n)&&!o.test(t)},r.tokenize=function(n){for(var t=n.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),o=0;o<t.length-1;o++)!t[o+1]&&t[o+2]&&e.test(t[o])&&e.test(t[o+2])&&(t[o]+=t[o+2],t.splice(o+1,2),o--);return t};var i=new n;function u(n){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},u(n)}i.tokenize=function(n){var t=[],e=n.split(/(\n|\r\n)/);e[e.length-1]||e.pop();for(var o=0;o<e.length;o++){var r=e[o];o%2&&!this.options.newlineIsToken?t[t.length-1]+=r:(this.options.ignoreWhitespace&&(r=r.trim()),t.push(r))}return t},(new n).tokenize=function(n){return n.split(/(\S.+?[.!?])(?=\s+|$)/)},(new n).tokenize=function(n){return n.split(/([{}:;,]|\s+)/)};var s=Object.prototype.toString,a=new n;function p(n,t,e,o,r){var i,a;for(t=t||[],e=e||[],o&&(n=o(r,n)),i=0;i<t.length;i+=1)if(t[i]===n)return e[i];if("[object Array]"===s.call(n)){for(t.push(n),a=new Array(n.length),e.push(a),i=0;i<n.length;i+=1)a[i]=p(n[i],t,e,o,r);return t.pop(),e.pop(),a}if(n&&n.toJSON&&(n=n.toJSON()),"object"===u(n)&&null!==n){t.push(n),a={},e.push(a);var c,l=[];for(c in n)n.hasOwnProperty(c)&&l.push(c);for(l.sort(),i=0;i<l.length;i+=1)a[c=l[i]]=p(n[c],t,e,o,c);t.pop(),e.pop()}else a=n;return a}a.useLongestToken=!0,a.tokenize=i.tokenize,a.castInput=function(n){var t=this.options,e=t.undefinedReplacement,o=t.stringifyReplacer,r=void 0===o?function(n,t){return void 0===t?e:t}:o;return"string"==typeof n?n:JSON.stringify(p(n,null,null,r),r,"  ")},a.equals=function(t,e){return n.prototype.equals.call(a,t.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};var c=new n;c.tokenize=function(n){return n.slice()},c.join=c.removeEmpty=function(n){return n}})();